zabbix_export:
  version: '7.4'
  template_groups:
    - uuid: 3fdb37c563464c49b24b75703e0038ed
      name: BA/MIBs
  templates:
    - uuid: 0d5221d8204a4e9eaedc70bb542141d0
      template: 'BA - MIB - Windows'
      name: 'BA - MIB - Windows (LanMgr)'
      vendor:
        name: 'below average'
        version: 0.0.0.0
      groups:
        - name: BA/MIBs
      items:
        - uuid: 6169c6dc8a6c4f27bcfc3c9dba907bdc
          name: 'Windows Service Discovery'
          type: SNMP_AGENT
          snmp_oid: 'walk[.1.3.6.1.4.1.77.1.2.3.1.1, .1.3.6.1.4.1.77.1.2.3.1.3]'
          key: windows.services
          history: '0'
          value_type: TEXT
          tags:
            - tag: 'Item Type'
              value: Discovery
      discovery_rules:
        - uuid: c0fc8e65860e4f4fbd32642e9118db1a
          name: 'Windows Services Discovery'
          type: DEPENDENT
          key: windows.services.discovery
          filter:
            evaltype: AND
            conditions:
              - macro: '{#NAME}'
                value: '{$WIN_SERVICES}'
              - macro: '{#NAME}'
                value: '{$WIN_SERVICES_IGNORE}'
                operator: NOT_MATCHES_REGEX
          enabled_lifetime_type: DISABLE_NEVER
          item_prototypes:
            - uuid: b450bb32c2a047bd8790c399a229b3ea
              name: 'Windows Service ({#NAME}) Status'
              type: DEPENDENT
              key: 'windows.services.status[{#NAME}]'
              history: 7d
              trends: 90d
              valuemap:
                name: 'Operating Status'
              preprocessing:
                - type: CHECK_NOT_SUPPORTED
                  parameters:
                    - '-1'
                  error_handler: CUSTOM_VALUE
                  error_handler_params: '5'
                - type: SNMP_WALK_VALUE
                  parameters:
                    - '.1.3.6.1.4.1.77.1.2.3.1.3.{#SNMPINDEX}'
                    - '0'
                  error_handler: CUSTOM_VALUE
                  error_handler_params: '5'
              master_item:
                key: windows.services
              tags:
                - tag: 'Item Type'
                  value: Status
                - tag: Service
                  value: '{#NAME}'
              trigger_prototypes:
                - uuid: 378d1d6f5c8446fb8430042af8a49e04
                  expression: 'last(/BA - MIB - Windows/windows.services.status[{#NAME}])<>1'
                  name: 'Windows Service ({#NAME}) Not Active'
                  priority: AVERAGE
                  manual_close: 'YES'
                  dependencies:
                    - name: 'Device offline'
                      expression: 'last(/BA - Generic - ICMP/icmppingretry[{HOST.HOST},3])=0'
                  tags:
                    - tag: 'Trigger Type'
                      value: State
          master_item:
            key: windows.services
          preprocessing:
            - type: SNMP_WALK_TO_JSON
              parameters:
                - '{#NAME}'
                - .1.3.6.1.4.1.77.1.2.3.1.1
                - '0'
      tags:
        - tag: Agent
          value: SNMP
        - tag: 'Template Type'
          value: Poller
      dashboards:
        - uuid: e4ec2731c79441a999eb38f3351d62d8
          name: 'Windows Services'
          pages:
            - widgets:
                - type: honeycomb
                  name: 'Windows Services'
                  width: '72'
                  height: '16'
                  fields:
                    - type: STRING
                      name: items.0
                      value: 'Windows Service*Status'
                    - type: STRING
                      name: primary_label
                      value: '{{ITEM.NAME}.regrepl("^Windows Service \(|\) Status$", "")}'
                    - type: INTEGER
                      name: primary_label_size_type
                      value: '1'
                    - type: STRING
                      name: reference
                      value: POOEJ
                    - type: INTEGER
                      name: secondary_label_bold
                      value: '0'
                    - type: INTEGER
                      name: secondary_label_size_type
                      value: '1'
                    - type: STRING
                      name: thresholds.0.color
                      value: 1B5E20
                    - type: STRING
                      name: thresholds.0.threshold
                      value: '1'
                    - type: STRING
                      name: thresholds.1.color
                      value: '891515'
                    - type: STRING
                      name: thresholds.1.threshold
                      value: '5'
      valuemaps:
        - uuid: a19ed2fd49044aaabeb7e90dca5873a6
          name: 'Operating Status'
          mappings:
            - value: '1'
              newvalue: 'üü¢ Active'
            - value: '2'
              newvalue: '‚èØÔ∏è Continuing'
            - value: '3'
              newvalue: '‚èØÔ∏è Pausing'
            - value: '4'
              newvalue: '‚è∏Ô∏è Paused'
            - value: '5'
              newvalue: 'üî¥ Stopped'

