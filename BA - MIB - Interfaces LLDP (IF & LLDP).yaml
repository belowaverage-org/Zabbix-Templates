zabbix_export:
  version: '7.4'
  template_groups:
    - uuid: 3fdb37c563464c49b24b75703e0038ed
      name: BA/MIBs
  templates:
    - uuid: e610e67b64ae4a89b9838318c002d244
      template: 'BA - MIB - Interfaces LLDP'
      name: 'BA - MIB - Interfaces LLDP (IF & LLDP)'
      vendor:
        name: 'below average'
        version: 0.0.0.0
      groups:
        - name: BA/MIBs
      items:
        - uuid: 6dae965baba64ff5867d18ea435a6b46
          name: 'Interfaces LLDP Discovery'
          type: SNMP_AGENT
          snmp_oid: 'walk[.1.0.8802.1.1.2.1.4.1.1.4,.1.3.6.1.2.1.31.1.1.1.1,.1.3.6.1.2.1.31.1.1.1.18,.1.0.8802.1.1.2.1.4.1.1.10,.1.0.8802.1.1.2.1.4.1.1.9,.1.0.8802.1.1.2.1.4.1.1.7]'
          key: snmp.interfaces.lldp
          delay: 15s
          history: '0'
          value_type: TEXT
      discovery_rules:
        - uuid: 792c76d171b54eb2b4308a4f0b4747c7
          name: 'Interfaces LLDP Discovery'
          type: DEPENDENT
          key: snmp.interfaces.lldp.discovery
          filter:
            conditions:
              - macro: '{#ALIAS}'
                value: '.*{$INTER_FILTER_REGEX}.*'
                operator: NOT_MATCHES_REGEX
              - macro: '{#NAME}'
                value: '.*{$INTER_FILTER_REGEX}.*'
                operator: NOT_MATCHES_REGEX
              - macro: '{#NAME}'
                value: '^(Vl|Bl|Nu).*$'
                operator: NOT_MATCHES_REGEX
          lifetime: 1d
          enabled_lifetime_type: DISABLE_NEVER
          item_prototypes:
            - uuid: 67a3110993f44f008ba62945fe121530
              name: 'Interface ({#NAME}: {#ALIAS}) LLDP Remote Description'
              type: DEPENDENT
              key: 'snmp.interfaces.lldp.desc[{#NAME}]'
              history: 365d
              value_type: CHAR
              preprocessing:
                - type: SNMP_WALK_VALUE
                  parameters:
                    - '.1.0.8802.1.1.2.1.4.1.1.10.{#SNMPINDEX}'
                    - '0'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1d
              master_item:
                key: snmp.interfaces.lldp
              tags:
                - tag: Interface
                  value: '{#NAME}'
                - tag: LLDP
                - tag: Type
                  value: Description
            - uuid: ac8d2f33e8444fba9e6275d1a531ebb2
              name: 'Interface ({#NAME}: {#ALIAS}) LLDP Remote Host'
              type: DEPENDENT
              key: 'snmp.interfaces.lldp.host[{#NAME}]'
              history: 365d
              value_type: CHAR
              preprocessing:
                - type: SNMP_WALK_VALUE
                  parameters:
                    - '.1.0.8802.1.1.2.1.4.1.1.9.{#SNMPINDEX}'
                    - '0'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1d
              master_item:
                key: snmp.interfaces.lldp
              tags:
                - tag: Interface
                  value: '{#NAME}'
                - tag: LLDP
                - tag: Type
                  value: Host
            - uuid: 0559d8d6479a4eac8e12a88170d63e89
              name: 'Interface ({#NAME}: {#ALIAS}) LLDP Remote Port'
              type: DEPENDENT
              key: 'snmp.interfaces.lldp.port[{#NAME}]'
              history: 365d
              value_type: CHAR
              preprocessing:
                - type: SNMP_WALK_VALUE
                  parameters:
                    - '.1.0.8802.1.1.2.1.4.1.1.7.{#SNMPINDEX}'
                    - '0'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1d
              master_item:
                key: snmp.interfaces.lldp
              tags:
                - tag: Interface
                  value: '{#NAME}'
                - tag: LLDP
                - tag: Type
                  value: 'Remote Port'
          master_item:
            key: snmp.interfaces.lldp
          preprocessing:
            - type: SNMP_WALK_TO_JSON
              parameters:
                - '{#LLDP}'
                - .1.0.8802.1.1.2.1.4.1.1.4
                - '0'
                - '{#NAME}'
                - .1.3.6.1.2.1.31.1.1.1.1
                - '0'
                - '{#ALIAS}'
                - .1.3.6.1.2.1.31.1.1.1.18
                - '0'
            - type: JAVASCRIPT
              parameters:
                - |
                  var newData = [];
                  var data = JSON.parse(value);
                  data.forEach(function(item1) {
                      if(item1['{#SNMPINDEX}'].includes('.')) {
                          data.forEach(function(item2) {
                              if(item1['{#SNMPINDEX}'].split('.')[1] == item2['{#SNMPINDEX}']) {
                                  item2['{#SNMPINDEX}'] = item1['{#SNMPINDEX}'];
                                  newData.push(item2);
                              }
                          });
                      }
                  });
                  return JSON.stringify(newData);
      tags:
        - tag: Type
          value: MIB

