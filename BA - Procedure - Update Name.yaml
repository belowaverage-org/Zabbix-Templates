zabbix_export:
  version: '7.4'
  template_groups:
    - uuid: d323af8072864defab6d6e380742fb4d
      name: BA/Procedures
  templates:
    - uuid: a63b4d7270ab4e44a4618cc7b23e7049
      template: 'BA - Procedure - Update Name'
      name: 'BA - Procedure - Update Name'
      vendor:
        name: 'below average'
        version: 0.0.0.0
      groups:
        - name: BA/Procedures
      items:
        - uuid: 9bb21d98410441d2b53177ca5f1a34a9
          name: 'Update Visible Name via Inventory'
          type: SCRIPT
          key: update.via.inventory
          delay: 12h
          history: 7d
          status: DISABLED
          params: |
            try {
            	var params = JSON.parse(value);
            	var wr = new HttpRequest();
            	wr.addHeader('Content-Type: application/json-rpc');
            	wr.addHeader('Authorization: Bearer ' + params.key);
            	var raw_resp = wr.post(params.api, JSON.stringify({
              		"jsonrpc": "2.0",
             		"method": "host.get",
             		"params": {
                			"selectInventory": [ "name" ],
            				"filter": {
            				"host": [ params.host ]
            		}},
            		"id": 1
            	}));
            	var response = JSON.parse(raw_resp);
            	var name = response.result[0].inventory.name.split('.')[0].toUpperCase();
            	var result = wr.post(params.api, JSON.stringify({
              	  "jsonrpc": "2.0",
             	   "method": "host.update",
             	   "params": {
             	       "hostid": response.result[0].hostid,
             	       "name": name  + ' (' + params.host + ')'
            	    },
            	    "id": 1
            	}));
            	return 0;
            } catch(e) {
            	return 1;
            }
          valuemap:
            name: 'Exit Code'
          timeout: 30s
          parameters:
            - name: api
              value: '{$ZABSELFAPI}'
            - name: host
              value: '{HOST.HOST}'
            - name: key
              value: '{$ZABSELFKEY}'
          tags:
            - tag: 'Item Type'
              value: Procedure
          triggers:
            - uuid: 97394f77de1142e7b8df29b84909b773
              expression: 'last(/BA - Procedure - Update Name/update.via.inventory)>0'
              name: 'Device name could not be updated'
              priority: INFO
              tags:
                - tag: 'Trigger Type'
                  value: Recent
      tags:
        - tag: 'Template Type'
          value: Procedure
      valuemaps:
        - uuid: 92c7e19c79934776b660d8ccb6ad3a1f
          name: 'Exit Code'
          mappings:
            - value: '0'
              newvalue: Success
            - value: '1'
              newvalue: Failed

