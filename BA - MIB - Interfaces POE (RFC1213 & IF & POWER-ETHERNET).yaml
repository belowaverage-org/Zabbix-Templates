zabbix_export:
  version: '7.4'
  template_groups:
    - uuid: 3fdb37c563464c49b24b75703e0038ed
      name: BA/MIBs
  templates:
    - uuid: c96e74b51406426fa9678cb3e36e305f
      template: 'BA - MIB - Interfaces POE'
      name: 'BA - MIB - Interfaces POE (RFC1213 & IF & POWER-ETHERNET)'
      vendor:
        name: 'below average'
        version: 0.0.0.0
      groups:
        - name: BA/MIBs
      discovery_rules:
        - uuid: fc9a676e681547f7976992861096cbee
          name: 'Interfaces POE Discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#POEENAB}, .1.3.6.1.2.1.105.1.1.1.3, {#IFINDEX}, .1.3.6.1.2.1.17.1.4.1.2, {#NAME}, .1.3.6.1.2.1.31.1.1.1.1, {#ALIAS}, .1.3.6.1.2.1.31.1.1.1.18, {#ASTATUS}, .1.3.6.1.2.1.2.2.1.7]'
          key: snmp.interfaces.poe.discovery
          delay: 1h
          filter:
            conditions:
              - macro: '{#ALIAS}'
                value: '.*{$INTER_FILTER_REGEX}.*'
                operator: NOT_MATCHES_REGEX
              - macro: '{#ASTATUS}'
                value: '2'
                operator: NOT_MATCHES_REGEX
              - macro: '{#NAME}'
                value: '.*{$INTER_FILTER_REGEX}.*'
                operator: NOT_MATCHES_REGEX
          lifetime: 1d
          enabled_lifetime_type: DISABLE_NEVER
          item_prototypes:
            - uuid: 608070fdd95b40d5b1d12d99608cfe02
              name: 'Interface ({#NAME}: {#ALIAS}) POE Admin Status'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.2.1.105.1.1.1.3.{#SNMPINDEX}'
              key: 'snmp.interfaces.poe.astatus[{#NAME}]'
              delay: 30m
              history: 7d
              valuemap:
                name: 'POE Admin'
              tags:
                - tag: 'Interface Name'
                  value: '{#NAME}'
                - tag: 'Item Type'
                  value: Status
            - uuid: 617cdf1c471444099069446bb97565b5
              name: 'Interface ({#NAME}: {#ALIAS}) POE Detection'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.2.1.105.1.1.1.6.{#SNMPINDEX}'
              key: 'snmp.interfaces.poe.dstatus[{#NAME}]'
              history: 7d
              valuemap:
                name: 'POE Status'
              tags:
                - tag: 'Interface Name'
                  value: '{#NAME}'
                - tag: 'Item Type'
                  value: Status
              trigger_prototypes:
                - uuid: c0a0fe136b29476a883a005dddc2a666
                  expression: 'last(/BA - MIB - Interfaces POE/snmp.interfaces.poe.dstatus[{#NAME}])=4 or last(/BA - MIB - Interfaces POE/snmp.interfaces.poe.dstatus[{#NAME}])=6'
                  name: 'Interface ({#NAME}: {#ALIAS}) POE Detection Fault'
                  priority: WARNING
                  manual_close: 'YES'
                  tags:
                    - tag: 'Trigger Type'
                      value: State
          preprocessing:
            - type: JAVASCRIPT
              parameters:
                - |
                  var newData = [];
                  var data = JSON.parse(value);
                  data.forEach(function(item1) {
                      if(item1['{#SNMPINDEX}'].includes('.')) {
                          data.forEach(function(item2) {
                              if(item1['{#SNMPINDEX}'].split('.')[1] == item2['{#SNMPINDEX}']) {
                                  item2['{#SNMPINDEX}'] = item1['{#SNMPINDEX}'];
                                  newData.push(item2);
                              }
                          });
                      }
                  });
                  return JSON.stringify(newData);
      tags:
        - tag: Agent
          value: SNMP
        - tag: 'Template Type'
          value: Poller
      valuemaps:
        - uuid: 850c51d7192742ab927fcdf43d7ae8a4
          name: 'POE Admin'
          mappings:
            - value: '1'
              newvalue: 'üü¢ Enabled'
            - value: '2'
              newvalue: 'üü† Disabled'
        - uuid: ef4f68d4621c45b29c33579af98ad7d3
          name: 'POE Status'
          mappings:
            - value: '1'
              newvalue: 'üü† Disabled'
            - value: '2'
              newvalue: 'üîé Searching'
            - value: '3'
              newvalue: '‚ö°Ô∏è Delivering Power'
            - value: '4'
              newvalue: 'üî¥ Fault'
            - value: '5'
              newvalue: 'üü° Test'
            - value: '6'
              newvalue: 'üî¥ Other Fault'

